<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Operio | Security</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <style>
        body {
            font-family: -apple-system, system-ui, sans-serif;
            background-color: #121212; /* Culoarea ta: bg */
            color: #e0e0e0; /* Culoarea ta: text */
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }
        .container {
            text-align: center;
            width: 100%;
            max-width: 380px;
            padding: 20px;
            box-sizing: border-box; /* Previne ieșirea elementelor din card */
        }
        .brand {
            font-size: 2.8rem;
            font-weight: 900;
            letter-spacing: -1.5px;
            margin-bottom: 0.5rem;
            color: #ffffff;
        }
        .accent-text { color: #00D2FF; } /* Culoarea ta: techBlue */

        h2 { font-size: 1.2rem; font-weight: 600; margin-bottom: 10px; color: #ffffff; }
        p { color: #aaaaaa; font-size: 0.9rem; line-height: 1.5; margin-bottom: 30px; padding: 0 10px; }

        /* Butonul Launch App - Fix pentru margini */
        .btn {
            background-color: #ffffff;
            color: #121212;
            padding: 16px 20px;
            border-radius: 12px;
            text-decoration: none;
            display: block; /* Ocupă lățimea disponibilă safe */
            font-weight: 800;
            font-size: 1rem;
            border: none;
            transition: transform 0.2s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        .btn:active { transform: scale(0.97); }

        input {
            width: 100%;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 12px;
            border: 1px solid #333;
            background: #1e1e1e; /* Culoarea ta: block */
            color: white;
            box-sizing: border-box;
            font-size: 1rem;
            text-align: center;
        }
        input:focus { border-color: #00D2FF; outline: none; }

        /* Footer: Operio | Built for scale */
        .footer-tag {
            margin-top: 50px;
            color: #aaaaaa; /* Culoarea ta: subText */
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .dot { width: 6px; height: 6px; background-color: #00D2FF; border-radius: 50%; }

        #loader { 
            border: 2px solid #333; 
            border-top: 2px solid #00D2FF; 
            border-radius: 50%; 
            width: 28px; height: 28px; 
            animation: spin 0.8s linear infinite; 
            margin: 20px auto; 
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div class="container">
    <div class="brand">Operio<span class="accent-text">.PRO</span></div>
    
    <div id="loader"></div>
    
    <div id="content">
        <h2 id="title">Security Check</h2>
        <p id="message">Unlocking professional strategic insights for your business scale.</p>
        <div id="action-area"></div>
    </div>

    <div class="footer-tag">
        <div class="dot"></div>
        Operio | Built for scale
        <div class="dot"></div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBTBR_8IJt2acR60Ar0eJI2_DmbajR8jVQ",
        authDomain: "operiostudio.firebaseapp.com",
        projectId: "operiostudio",
        storageBucket: "operiostudio.firebasestorage.app",
        messagingSenderId: "658608089594",
        appId: "1:658608089594:web:cc743429c5531f72d91c43",
        measurementId: "G-F7CKKCYBEZ"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const urlParams = new URLSearchParams(window.location.search);
    const mode = urlParams.get('mode');
    const oobCode = urlParams.get('oobCode');

    const titleEl = document.getElementById('title');
    const messageEl = document.getElementById('message');
    const actionArea = document.getElementById('action-area');
    const loader = document.getElementById('loader');

    const done = () => loader.style.display = 'none';

    if (!oobCode) {
        titleEl.innerText = "Link Invalid";
        messageEl.innerText = "Please request a new link from the Operio app.";
        done();
    } else {
        switch (mode) {
            case 'verifyEmail':
                auth.applyActionCode(oobCode).then(() => {
                    done();
                    titleEl.innerText = "Email Verified";
                    messageEl.innerText = "Your strategic account is now ready.";
                    actionArea.innerHTML = `<a href="operio://login" class="btn">Launch App</a>`;
                }).catch(() => {
                    done();
                    titleEl.innerText = "Link Expired";
                    messageEl.innerText = "This link is no longer valid.";
                });
                break;

            case 'resetPassword':
                auth.verifyPasswordResetCode(oobCode).then(email => {
                    done();
                    titleEl.innerText = "Reset Password";
                    messageEl.innerText = `New password for ${email}`;
                    actionArea.innerHTML = `
                        <input type="password" id="p1" placeholder="New Password">
                        <button onclick="updatePass()" class="btn">Launch App</button>
                    `;
                }).catch(() => {
                    done();
                    titleEl.innerText = "Error";
                    messageEl.innerText = "Invalid security code.";
                });
                break;
                
            case 'recoverEmail':
                auth.applyActionCode(oobCode).then(() => {
                    done();
                    titleEl.innerText = "Email Restored";
                    messageEl.innerText = "Account secured.";
                    actionArea.innerHTML = `<a href="operio://login" class="btn">Launch App</a>`;
                }).catch(() => { done(); titleEl.innerText = "Error"; });
                break;
        }
    }

    window.updatePass = function() {
        const p = document.getElementById('p1').value;
        if(p.length < 6) return alert("Password too short!");
        auth.confirmPasswordReset(oobCode, p).then(() => {
            titleEl.innerText = "Success";
            messageEl.innerText = "Your password has been updated.";
            actionArea.innerHTML = `<a href="operio://login" class="btn">Launch App</a>`;
        }).catch(e => alert(e.message));
    }
</script>
</body>
</html>
