<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Operio | Security</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap');

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background-color: #121212; /* bg */
            color: #e0e0e0; /* text */
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        .container {
            text-align: center;
            width: 100%;
            max-width: 400px;
            padding: 40px 24px;
            box-sizing: border-box;
        }

        .brand {
            font-size: 3rem;
            font-weight: 900;
            letter-spacing: -1.5px;
            margin-bottom: 10px;
            color: #ffffff;
        }
        .accent-text { 
            color: #3498db;
            margin-left: 8px;
        }

        h2 { 
            font-size: 1.1rem; 
            font-weight: 600; 
            text-transform: uppercase; 
            letter-spacing: 4px; 
            margin-bottom: 15px;
            color: #ffffff;
        }

        p { 
            color: #aaaaaa; /* subText */
            font-size: 0.9rem; 
            line-height: 1.6; 
            margin-bottom: 40px;
            letter-spacing: 0.5px;
        }

        .input-group {
            position: relative;
            margin-bottom: 16px;
            width: 100%;
        }

        input {
            width: 100%;
            padding: 18px 20px;
            border-radius: 14px;
            border: 1px solid #333; /* border color */
            background: #1e1e1e; /* block color */
            color: #ffffff;
            box-sizing: border-box;
            font-size: 1rem;
            font-family: inherit;
            transition: border-color 0.3s ease;
        }

        input:focus {
            border-color: #3498db;
            outline: none;
        }

        .toggle-password {
            position: absolute;
            right: 18px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 22px;
            height: 22px;
            color: #666;
            user-select: none;
            transition: color 0.2s;
        }
        
        .toggle-password:hover {
            color: #3498db;
        }

        .btn {
            background-color: #ffffff;
            color: #121212;
            padding: 18px 20px;
            border-radius: 14px;
            text-decoration: none;
            display: block;
            font-weight: 800;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            border: none;
            width: 100%;
            box-sizing: border-box;
            margin-top: 10px;
            transition: all 0.2s ease;
            box-shadow: 0 10px 25px rgba(0,0,0,0.4);
            cursor: pointer;
        }

        .btn:hover { background-color: #f0f0f0; transform: translateY(-2px); }
        .btn:active { transform: scale(0.98); }

        .footer-tag {
            margin-top: 60px;
            color: #aaaaaa;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            opacity: 0.6;
        }

        .dot { 
            width: 6px; 
            height: 6px; 
            background-color: #3498db; 
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.6);
        }

        #loader { 
            border: 2px solid #333; 
            border-top: 2px solid #3498db; 
            border-radius: 50%; 
            width: 30px; height: 30px; 
            animation: spin 0.8s linear infinite; 
            margin: 20px auto; 
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container">
    <div class="brand">Operio.<span class="accent-text">PRO</span></div>
    
    <div id="loader"></div>
    
    <div id="content">
        <h2 id="title">Security Check</h2>
        <p id="message">Validating your credentials for professional strategic scaling.</p>
        <div id="action-area"></div>
    </div>

    <div class="footer-tag">
        <div class="dot"></div>
        Built for scale
        <div class="dot"></div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBTBR_8IJt2acR60Ar0eJI2_DmbajR8jVQ",
        authDomain: "operiostudio.firebaseapp.com",
        projectId: "operiostudio",
        storageBucket: "operiostudio.firebasestorage.app",
        messagingSenderId: "658608089594",
        appId: "1:658608089594:web:cc743429c5531f72d91c43",
        measurementId: "G-F7CKKCYBEZ"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const urlParams = new URLSearchParams(window.location.search);
    const mode = urlParams.get('mode');
    const oobCode = urlParams.get('oobCode');

    const titleEl = document.getElementById('title');
    const messageEl = document.getElementById('message');
    const actionArea = document.getElementById('action-area');
    const loader = document.getElementById('loader');

    const done = () => loader.style.display = 'none';

    // SVG Icons
    const eyeOpen = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" style="width:20px; height:20px;"><path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.183.182.548.182 1.118 0 1.666L19.964 13.911C18.577 18.087 14.64 21 12 21c-4.638 0-8.573-3.007-9.963-7.183z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0z" /></svg>`;
    const eyeClosed = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" style="width:20px; height:20px;"><path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88" /></svg>`;

    window.toggleView = function(id) {
        const input = document.getElementById(id);
        const icon = input.nextElementSibling;
        if (input.type === "password") {
            input.type = "text";
            icon.innerHTML = eyeClosed;
        } else {
            input.type = "password";
            icon.innerHTML = eyeOpen;
        }
    };

    if (!oobCode) {
        titleEl.innerText = "Link Invalid";
        messageEl.innerText = "Please request a new link from the Operio app.";
        done();
    } else {
        switch (mode) {
            case 'verifyEmail':
                auth.applyActionCode(oobCode).then(() => {
                    done();
                    titleEl.innerText = "Verified";
                    messageEl.innerText = "Your account is activated and ready.";
                    actionArea.innerHTML = `<a href="operio://login" class="btn">Launch App</a>`;
                }).catch(() => {
                    done();
                    titleEl.innerText = "Expired";
                    messageEl.innerText = "This security link has expired.";
                });
                break;

            case 'resetPassword':
                auth.verifyPasswordResetCode(oobCode).then(email => {
                    done();
                    titleEl.innerText = "Reset Password";
                    messageEl.innerText = `Securing account for ${email}`;
                    actionArea.innerHTML = `
                        <div class="input-group">
                            <input type="password" id="p1" placeholder="New Password">
                            <span class="toggle-password" onclick="toggleView('p1')">${eyeOpen}</span>
                        </div>
                        <div class="input-group">
                            <input type="password" id="p2" placeholder="Confirm Password">
                            <span class="toggle-password" onclick="toggleView('p2')">${eyeOpen}</span>
                        </div>
                        <button onclick="updatePass()" class="btn">Launch App</button>
                    `;
                }).catch(() => {
                    done();
                    titleEl.innerText = "Error";
                    messageEl.innerText = "Security code is invalid.";
                });
                break;
                
            case 'recoverEmail':
                auth.applyActionCode(oobCode).then(() => {
                    done();
                    titleEl.innerText = "Recovered";
                    messageEl.innerText = "Email address has been restored.";
                    actionArea.innerHTML = `<a href="operio://login" class="btn">Launch App</a>`;
                }).catch(() => { done(); titleEl.innerText = "Error"; });
                break;
        }
    }

    window.updatePass = function() {
        const p1 = document.getElementById('p1').value;
        const p2 = document.getElementById('p2').value;
        
        if(p1.length < 6) return alert("Password must be at least 6 characters!");
        if(p1 !== p2) return alert("Passwords do not match!");

        auth.confirmPasswordReset(oobCode, p1).then(() => {
            titleEl.innerText = "Success";
            messageEl.innerText = "Password updated. You can now enter the app.";
            actionArea.innerHTML = `<a href="operio://login" class="btn">Launch App</a>`;
        }).catch(e => alert(e.message));
    }
</script>
</body>
</html>
