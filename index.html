<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Operio | Security</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #000000;
            color: #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        .container {
            text-align: center;
            width: 90%;
            max-width: 400px;
        }
        /* Design Operio.PRO */
        .brand {
            font-size: 2.5rem;
            font-weight: 900;
            letter-spacing: -1px;
            margin-bottom: 1rem;
            color: #ffffff;
        }
        .accent { color: #ca4cce; } /* Culorile tale: colors.accent */

        h2 { font-size: 1.2rem; font-weight: 600; margin-bottom: 10px; color: #eee; }
        p { color: #888; font-size: 0.95rem; line-height: 1.5; margin-bottom: 30px; }

        /* Butonul alb frumos */
        .btn {
            background-color: #ffffff;
            color: #000000;
            padding: 16px 32px;
            border-radius: 50px;
            text-decoration: none;
            display: inline-block;
            font-weight: 700;
            font-size: 1rem;
            border: none;
            width: 100%;
            box-sizing: border-box;
            transition: transform 0.2s ease, opacity 0.2s ease;
        }
        .btn:active { transform: scale(0.98); opacity: 0.9; }

        input {
            width: 100%;
            padding: 15px;
            margin-bottom: 12px;
            border-radius: 12px;
            border: 1px solid #333;
            background: #111;
            color: white;
            box-sizing: border-box;
            font-size: 1rem;
            text-align: center;
        }

        /* Footer text: Built for scale */
        .footer-tag {
            margin-top: 40px;
            color: #555;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .dot { width: 4px; height: 4px; background-color: #ca4cce; border-radius: 50%; }

        #loader { 
            border: 2px solid #222; 
            border-top: 2px solid #ffffff; 
            border-radius: 50%; 
            width: 24px; height: 24px; 
            animation: spin 0.8s linear infinite; 
            margin: 20px auto; 
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div class="container">
    <div class="brand">Operio<span class="accent">.PRO</span></div>
    
    <div id="loader"></div>
    
    <div id="content">
        <h2 id="title">Security Check</h2>
        <p id="message">Verifying your request to keep your strategic insights professional.</p>
        <div id="action-area"></div>
    </div>

    <div class="footer-tag">
        <div class="dot"></div>
        Operio | Built for scale
        <div class="dot"></div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBTBR_8IJt2acR60Ar0eJI2_DmbajR8jVQ",
        authDomain: "operiostudio.firebaseapp.com",
        projectId: "operiostudio",
        storageBucket: "operiostudio.firebasestorage.app",
        messagingSenderId: "658608089594",
        appId: "1:658608089594:web:cc743429c5531f72d91c43",
        measurementId: "G-F7CKKCYBEZ"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const urlParams = new URLSearchParams(window.location.search);
    const mode = urlParams.get('mode');
    const oobCode = urlParams.get('oobCode');

    const titleEl = document.getElementById('title');
    const messageEl = document.getElementById('message');
    const actionArea = document.getElementById('action-area');
    const loader = document.getElementById('loader');

    const hideLoader = () => loader.style.display = 'none';

    if (!oobCode) {
        titleEl.innerText = "Link Invalid";
        messageEl.innerText = "Te rugăm să ceri un link nou din aplicație.";
        hideLoader();
    } else {
        switch (mode) {
            case 'verifyEmail':
                auth.applyActionCode(oobCode).then(() => {
                    hideLoader();
                    titleEl.innerText = "Email Verified";
                    messageEl.innerText = "Account is now active. Return to Operio to continue.";
                    actionArea.innerHTML = `<a href="operio://login" class="center btn">Launch App</a>`;
                }).catch(() => {
                    hideLoader();
                    titleEl.innerText = "Expired";
                    messageEl.innerText = "This link is no longer valid.";
                });
                break;

            case 'resetPassword':
                auth.verifyPasswordResetCode(oobCode).then(email => {
                    hideLoader();
                    titleEl.innerText = "New Password";
                    messageEl.innerText = `Set a secure password for ${email}`;
                    actionArea.innerHTML = `
                        <input type="password" id="p1" placeholder="New Password">
                        <button onclick="updatePass()" class="btn">Reset Password</button>
                    `;
                }).catch(() => {
                    hideLoader();
                    titleEl.innerText = "Error";
                    messageEl.innerText = "Invalid reset link.";
                });
                break;
                
            case 'recoverEmail':
                auth.applyActionCode(oobCode).then(() => {
                    hideLoader();
                    titleEl.innerText = "Email Restored";
                    messageEl.innerText = "Your account is secure. Return to app.";
                    actionArea.innerHTML = `<a href="operio://login" class="btn">Return to App</a>`;
                }).catch(() => { hideLoader(); titleEl.innerText = "Error"; });
                break;
        }
    }

    window.updatePass = function() {
        const p = document.getElementById('p1').value;
        if(p.length < 6) return alert("Too short!");
        auth.confirmPasswordReset(oobCode, p).then(() => {
            titleEl.innerText = "Success";
            messageEl.innerText = "Password updated.";
            actionArea.innerHTML = `<a href="operio://login" class="btn">Launch App</a>`;
        }).catch(e => alert(e.message));
    }
</script>
</body>
</html>
